from core import Node
from core import StateException
from core import Topic


def message_injection(target_node: Node, target_topic: Topic, node_name: str):
    """
    Inject data into a topic
    :param target_node: The node you want to inject data into. It could be a list
    :param target_topic: The Topic you want ot inject data into
    :param node_name: The name to give for this script.
    :return:
    """
    # TODO: Have data here.
    injection_url = "http://localhost:12345"
    (_, _, target_bus) = target_node.get_sub_list(node_name=node_name)
    subscriber_list = [target_topic.name in s for s in target_node.sub_topics]
    if len(subscriber_list) is 0:
        raise StateException("Node is not subscribed to topic ")
    else:
        # TODO: THIS SHOULDN'T DO ANYTHING
        for subscriber in subscriber_list:
            # TODO: CREATE TOPIC TO CONNECT TO.
            target_node.server.publisherUpdate(node_name, subscriber.name, injection_url)
    print("TODO")
